<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Conceitual: Teoria do Multifluxo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        h1 {
            font-weight: 300;
            margin-bottom: 10px;
            text-align: center;
        }
        #canvas-container {
            border: 1px solid #333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5 );
            margin-bottom: 20px;
        }
        .controls-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 80%;
            max-width: 800px;
        }
        .slider-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }
        label {
            font-size: 14px;
            margin-bottom: 8px;
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #333;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
        }
        #slider-pressao::-webkit-slider-thumb { background: #ff6b6b; }
        #slider-vorticidade::-webkit-slider-thumb { background: #4dff94; }
        #slider-alinhamento::-webkit-slider-thumb { background: #4db8ff; }
        .value-display {
            font-size: 12px;
            margin-top: 5px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <h1>Simulador Conceitual: Teoria do Multifluxo</h1>
    <div id="canvas-container"></div>
    <div class="controls-container">
        <div class="slider-group">
            <label for="slider-pressao">Pressão (Choque)</label>
            <input type="range" id="slider-pressao" min="0" max="100" value="0">
            <span id="pressao-valor" class="value-display">0</span>
        </div>
        <div class="slider-group">
            <label for="slider-vorticidade">Vorticidade (Turbulência)</label>
            <input type="range" id="slider-vorticidade" min="0" max="100" value="0">
            <span id="vorticidade-valor" class="value-display">0</span>
        </div>
        <div class="slider-group">
            <label for="slider-alinhamento">Alinhamento (Laminar)</label>
            <input type="range" id="slider-alinhamento" min="0" max="100" value="100">
            <span id="alinhamento-valor" class="value-display">100</span>
        </div>
    </div>

    <script>
        let particulas = [];
        const numParticulas = 400;

        let sliderPressao, sliderVorticidade, sliderAlinhamento;
        let valorPressao, valorVorticidade, valorAlinhamento;

        function setup() {
            let canvasWidth = Math.min(windowWidth * 0.9, 800);
            let canvasHeight = Math.min(windowHeight * 0.5, 500);
            let canvas = createCanvas(canvasWidth, canvasHeight);
            canvas.parent('canvas-container');

            for (let i = 0; i < numParticulas; i++) {
                particulas.push(new Particula());
            }

            sliderPressao = select('#slider-pressao');
            sliderVorticidade = select('#slider-vorticidade');
            sliderAlinhamento = select('#slider-alinhamento');
            
            valorPressao = select('#pressao-valor');
            valorVorticidade = select('#vorticidade-valor');
            valorAlinhamento = select('#alinhamento-valor');
        }

        function draw() {
            background(18, 18, 18, 150); // Fundo escuro com um pouco de rastro

            let pressao = sliderPressao.value();
            let vorticidade = sliderVorticidade.value();
            let alinhamento = sliderAlinhamento.value();

            valorPressao.html(pressao);
            valorVorticidade.html(vorticidade);
            valorAlinhamento.html(alinhamento);

            for (let p of particulas) {
                p.aplicarForcas(pressao, vorticidade, alinhamento);
                p.atualizar();
                p.mostrar(pressao, vorticidade, alinhamento);
                p.verificarBordas();
            }
        }
        
        function windowResized() {
            let canvasWidth = Math.min(windowWidth * 0.9, 800);
            let canvasHeight = Math.min(windowHeight * 0.5, 500);
            resizeCanvas(canvasWidth, canvasHeight);
        }

        class Particula {
            constructor() {
                this.pos = createVector(random(width), random(height));
                this.vel = createVector(random(1, 2), 0);
                this.acc = createVector(0, 0);
                this.maxSpeed = 4;
                this.history = [];
            }

            aplicarForcas(pressao, vorticidade, alinhamento) {
                // Força de Alinhamento (Laminar)
                let forcaAlinhamento = createVector(map(alinhamento, 0, 100, 0.01, 0.2), 0);
                this.acc.add(forcaAlinhamento);

                // Força de Vorticidade (Turbulência)
                let anguloRuido = noise(this.pos.x * 0.005, this.pos.y * 0.005, frameCount * 0.01) * TWO_PI * 4;
                let forcaVorticidade = p5.Vector.fromAngle(anguloRuido);
                forcaVorticidade.setMag(map(vorticidade, 0, 100, 0, 0.5));
                this.acc.add(forcaVorticidade);

                // Força de Pressão (Choque)
                let zonaChoque = width * 0.6;
                if (this.pos.x > zonaChoque - pressao && this.pos.x < zonaChoque + 20) {
                    let forcaChoque = createVector(-map(pressao, 0, 100, 0, 1.5), 0);
                    this.acc.add(forcaChoque);
                }
            }

            atualizar() {
                this.vel.add(this.acc);
                this.vel.limit(this.maxSpeed);
                this.pos.add(this.vel);
                this.acc.mult(0); // Reseta a aceleração
                
                this.history.push(this.pos.copy());
                if (this.history.length > 5) {
                    this.history.splice(0, 1);
                }
            }

            mostrar(p, v, a) {
                // Determinar cor baseada na dominância
                let total = parseFloat(p) + parseFloat(v) + parseFloat(a);
                if (total === 0) total = 1;
                let r = map(p, 0, total, 0, 255);
                let g = map(v, 0, total, 0, 255);
                let b = map(a, 0, total, 0, 255);

                noStroke();
                fill(r + 50, g + 50, b + 50, 200); // Adiciona brilho
                ellipse(this.pos.x, this.pos.y, 4, 4);
                
                // Desenhar rastro
                beginShape();
                noFill();
                stroke(r + 50, g + 50, b + 50, 100);
                strokeWeight(1);
                for(let i = 0; i < this.history.length; i++){
                    vertex(this.history[i].x, this.history[i].y);
                }
                endShape();
            }

            verificarBordas() {
                if (this.pos.x > width) {
                    this.pos.x = 0;
                    this.history = [];
                }
                if (this.pos.x < 0) {
                    this.pos.x = width;
                    this.history = [];
                }
                if (this.pos.y > height) {
                    this.pos.y = 0;
                    this.history = [];
                }
                if (this.pos.y < 0) {
                    this.pos.y = height;
                    this.history = [];
                }
            }
        }
    </script>
</body>
</html>

